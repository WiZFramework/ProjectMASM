<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<link href="css/main.css" rel="stylesheet" type="text/css">
<title>ProjectMASM</title>
</head>
<body>
<!-- 全体コンテナ　-->
<div id="container">
<div id="header">
<h3>ProjectMASM</h3>
</div>
<!-- コンテンツ　-->
<div id="contents">
<h2>１．基本的なサンプル</h2>
<h3>１－３．C++からMASMの関数を呼び出す（64ビット版）</h3>
<h4>プロジェクトの作成</h4>
　この内容は<b> Sample103</b>にあります。<br />
　まず<b>VS2019</b>を起動し<b>新しいプロジェクトの作成</b>を選択し<b>コンソールアプリケーション</b>を作成します。プロジェクト名は<b>Sample103</b>とします。<br />
　作成方法は、<a href="01_02.html">１－２．C++からMASMの関数を呼び出す（32ビット版）</a>を参考にしてください。ここまでは同じです。<br />
　続いて、<b>64ビット版</b>の指定です。<br/>
　メニューの下にある<b>構成</b>の選択エリアで<b>x64</b>を指定してください。これが<b>64ビットモード</b>です。<br />
<p>&nbsp;</p>
<img src="img/01_03a.png" width="80%" border="1"/>
<p>図0103a</p>
<p>&nbsp;</p>
　続いて<b>プロジェクト名</b>を右クリックして<b>ビルドの依存関係－ビルドのカスタマイズ</b>を選びます。
<p>&nbsp;</p>
<img src="img/01_03b.png" width="80%" border="1"/>
<p>図0103b</p>
<p>&nbsp;</p>
　そこで<b>masm</b>を選び、<b>OK</b>します
<p>&nbsp;</p>
<img src="img/01_03c.png" width="80%" border="1"/>
<p>図0103c</p>
<p>&nbsp;</p>
<h4>アセンブラの記述</h4>
　<b>ソースファイル－追加－新しい項目</b>を選びます。
<p>&nbsp;</p>
<img src="img/01_03d.png" width="80%" border="1"/>
<p>図0103d</p>
<p>&nbsp;</p>
　<b>Source.asm</b>を作成します。
<p>&nbsp;</p>
<img src="img/01_03e.png" width="80%" border="1"/>
<p>図0103e</p>
<p>&nbsp;</p>
　<b>Source.asm</b>を右ボタンクリックして<b>プロパティ</b>を選びます。
<p>&nbsp;</p>
<img src="img/01_03f.png" width="80%" border="1"/>
<p>図0103f</p>
<p>&nbsp;</p>
　<b>項目の種類</b>が<b>Microsoft Macro Assembler</b>になっているのを確認します。<br />
　その後<b>Source.asm</b>に以下を記述します。
<div class="box1">
<pre>

.code

;int func103
func103 proc
        sub     ecx,edx
        mov     eax,ecx
        ret
func103 endp
        end

</pre>
</div>
<h4>cppの記述</h4>
　その後<b>Sample103.cpp</b>に以下を記述します。
<div class="box1">
<pre>
#include &lt;iostream>

extern "C" int func103(int, int);

int main()
{
    std::cout &lt;&lt; func103(70, 50) &lt;&lt; "\n";
}
</pre>
</div>
　<b>ビルド－リビルド</b>でコンパイルします。<br />
　その後、<b>デバッグ－デバッグなしで実行</b>で以下が表示されれば成功です。
<div class="box1">
<pre>
20

...\ProjectMASM\Sample103\x64\Release\Sample103.exe (プロセス 16928) は、コード 0 を伴って終了しました。
このウィンドウを閉じるには、任意のキーを押してください . . .
</pre>
</div>
　この項を見るとわかるように、<b>64ビット版アセンブラ</b>は<b>C/C++</b>から呼び出すのに、そんなに手間はかからないと思います。<br />
　<b>Sample102</b>と比べてください。
</div>
<!-- /コンテンツ　-->
<hr>
<!-- フッタ　-->
<ul class="foot_navi">
<li><a href="01_02.html">前へ</a></li>
<li><a href="index.html">目次</a></li>
<li><a href="01_04.html">次へ</a></li>
</ul>
<!-- /フッタ　-->


</div>
<!-- /全体コンテナ　-->
</body>
</html>
